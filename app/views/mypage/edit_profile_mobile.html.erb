<%= render partial: 'top_mobile', locals: {title: current_user.nickname} %>

<section id="profile-img">
  <div class="mypage-profile-img-position text-center">
    <input type="file" name="profile_img" id="profile" accept="image/*" class="mypage-inputfile">
    <label for="profile">
      <div class="mypage-profile-img-container">
        <% if current_user.profile_img %>
            <%= image_tag("#{current_user.profile_img}",id: "upload-profile-img", class: "mypage-profile-img") %>
        <% else %>
            <%= image_tag("image_profile", id: "upload-profile-img", class: "mypage-profile-img") %>
        <% end %>
        <div class="mypage-edit-pencil">
          <%= image_tag("icon_pencil_black", style: "height: 100%; width: auto;") %>
        </div>
      </div>
    </label>

    <br/>

    <div><%= current_user.email %></div>

    <br/>

    <input value="<%= current_user.nickname %>arbitary nickname input" class="class-A" style="border:1px black solid;width:300px;height:100px;" id="nickname-field" readonly />
    <span id="tog-1">
      <%= image_tag("icon_pencil_black", id:"button-1", style: "height: 30px; width: auto;") %>
      <%= image_tag("icon_pencil_white", id:"button-1", style: "border:1px black solid;height: 30px; width: auto;display: none") %>
    </span>
    <br/>

    <input id="introduce-field" style="border:1px black solid" id="introduce-field" size="10" readonly="readonly" onclick="toggleField"/>
    <span id="tog-2">
      <%= image_tag("icon_pencil_black", id:"button-1", style: "height: 30px; width: auto;") %>
      <%= image_tag("icon_pencil_white", id:"button-1", style: "border:1px black solid;height: 30px; width: auto;display:none;") %>
    </span>
  </div>
</section>

<script>
  $('#tog-1').on("click", function(event) {
      toggleField($('#nickname-field'), this, "<%= mypage_update_nickname_path %>");
  });
  $('#tog-2').on("click", function(event) {
      toggleField($('#introduce-field'), this, "<%= mypage_update_introduce_path %>");
  });

  function toggleField(target, button, url) {
      if (target.prop("readOnly")) {
          target.prop("readOnly", false);
          target.toggleClass("class-A class-B");
          $('img', button).toggle();
      } else {
          $.ajax({
              method: "GET",
              url: url,
              data: { nickname: target.val() },
              success: function(data) {
                  console.log(data);
                  target.prop("value", data.nickname);
                  target.prop("readOnly", true);
                  target.toggleClass("class-A class-B");
                  $('img', button).toggle();
                  $('.mypage-header-container').find('h1').text(data.nickname);
              }
          });
      }
  }
</script>